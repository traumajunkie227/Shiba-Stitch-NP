{% comment %}
  Displays up to two restricted collections manually selected via the theme editor.
  Products show only if tagged 'wholesale-duplicate' or the customer is tagged 'wholesale'.
{% endcomment %}

<section class="collection-restricted" style="background-color: #EEEBE3; padding: 1rem 1rem 2rem;">

  {% assign customer_wholesale = false %}
  {% if customer and customer.tags contains 'wholesale' %}
    {% assign customer_wholesale = true %}
  {% endif %}

  {% assign collection_1 = section.settings.collection_1 %}
  {% assign collection_2 = section.settings.collection_2 %}

  {% if collection_1 != blank %}
    {% assign collection = collections[collection_1] %}
    {% if collection != blank %}
      <h1 class="collection-title">{{ collection.title }}</h1>

      {% if collection.description != blank %}
        <div class="collection-description">{{ collection.description }}</div>
      {% endif %}

      {% assign visible_products = '' %}
      {% for product in collection.products %}
        {% if product.tags contains 'wholesale-duplicate' or customer_wholesale %}
          {% capture visible_products %}{{ visible_products }}x{% endcapture %}
        {% endif %}
      {% endfor %}

      {% if visible_products != '' %}
        <div class="collection-tools page-width" style="margin: 1rem 0;">
          <div class="facets facets-horizontal" style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
            {% render 'facet-filters', results: collection %}
            {% render 'sort-by', results: collection %}
          </div>
        </div>

        <div class="product-grid">
          {% for product in collection.products %}
            {% if product.tags contains 'wholesale-duplicate' or customer_wholesale %}
              {% render 'product-card', product: product %}
            {% endif %}
          {% endfor %}
        </div>
      {% else %}
        <p style="text-align: center; padding: 2rem;">
          This collection is only available to approved wholesale customers.
        </p>
      {% endif %}
    {% endif %}
  {% endif %}

  {% if collection_2 != blank %}
    {% assign collection = collections[collection_2] %}
    {% if collection != blank %}
      {% if section.settings.second_heading != blank %}
        <h2 class="collection-second-heading">{{ section.settings.second_heading }}</h2>
      {% else %}
        <h2 class="collection-second-heading">{{ collection.title }}</h2>
      {% endif %}

      {% if collection.description != blank %}
        <div class="collection-description">{{ collection.description }}</div>
      {% endif %}

      {% assign visible_products = '' %}
      {% for product in collection.products %}
        {% if product.tags contains 'wholesale-duplicate' or customer_wholesale %}
          {% capture visible_products %}{{ visible_products }}x{% endcapture %}
        {% endif %}
      {% endfor %}

      {% if visible_products != '' %}
        <div class="collection-tools page-width" style="margin: 1rem 0;">
          <div class="facets facets-horizontal" style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
            {% render 'facet-filters', results: collection %}
            {% render 'sort-by', results: collection %}
          </div>
        </div>

        <div class="product-grid">
          {% for product in collection.products %}
            {% if product.tags contains 'wholesale-duplicate' or customer_wholesale %}
              {% render 'product-card', product: product %}
            {% endif %}
          {% endfor %}
        </div>
      {% else %}
        <p style="text-align: center; padding: 2rem;">
          This collection is only available to approved wholesale customers.
        </p>
      {% endif %}
    {% endif %}
  {% endif %}
</section>

<style>
  @media screen and (max-width: 768px) {
    .collection-restricted .collection-title,
    .collection-restricted .collection-second-heading {
      font-size: 1.75rem;
      text-align: center;
    }

    .collection-restricted .facets-horizontal {
      flex-direction: column;
      align-items: stretch;
    }

    .collection-restricted .product-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }

  @media screen and (min-width: 769px) {
    .collection-restricted .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 2rem;
    }
  }
</style>

{% schema %}
{
  "name": "Restricted Collection",
  "settings": [
    {
      "type": "collection",
      "id": "collection_1",
      "label": "Primary Collection"
    },
    {
      "type": "collection",
      "id": "collection_2",
      "label": "Optional Second Collection"
    },
    {
      "type": "text",
      "id": "second_heading",
      "label": "Heading for Second Collection",
      "default": "More Products"
    }
  ],
  "presets": [
    {
      "name": "Restricted Collection"
    }
  ]
}
{% endschema %}
