{% comment %}
  Section: collection-restricted-section.liquid
  Filters products based on customer/product tag visibility
{% endcomment %}

<section class="collection-restricted">
  <h1>{{ collection.title }}</h1>
  {% if collection.description != blank %}
    <div class="collection-description">{{ collection.description }}</div>
  {% endif %}

  <div class="product-grid">
    {% assign customer_wholesale = false %}
    {% if customer and customer.tags contains 'wholesale' %}
      {% assign customer_wholesale = true %}
    {% endif %}

    {% for product in collection.products %}
      {% assign is_wholesale_product = false %}
      {% if product.tags contains 'wholesale-duplicate' %}
        {% assign is_wholesale_product = true %}
      {% endif %}

      {% if is_wholesale_product or customer_wholesale %}
        <div class="product-card">
          <a href="{{ product.url }}">
            <h2>{{ product.title }}</h2>
            {% if product.featured_image %}
              <img src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}">
            {% endif %}
            <p>{{ product.price | money }}</p>
          </a>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>
